<%- include('partials/header') %>




<!-- Vehicle Carousel -->
<div class="carousel-container">
  
  <h3 class="section-title">Featured Vehicles</h3>
  
  <div class="carousel-controls">
    <button class="carousel-btn prev-btn" aria-label="Previous">
      <i class="fas fa-chevron-left"></i>
    </button>
    <div class="carousel" id="vehicles-carousel">
      <div class="carousel-inner" id="carousel-inner">
        <% if (vehicles && vehicles.length > 0) { %>
          <% vehicles.forEach(vehicle => { %>
            <div class="vehicle-card">
              <div class="vehicle-card-image">
                <% if (vehicle.image) { %>
                  <img src="<%= vehicle.image %>" alt="<%= vehicle.brand %> <%= vehicle.model %>">
                <% } else { %>
                  <img src="/images/vehicles/default-vehicle.svg" alt="<%= vehicle.brand %> <%= vehicle.model %>">
                <% } %>
              </div>
              <div class="vehicle-card-content">
                <h4>
                  <% if (vehicle.name) { %>
                    <%= vehicle.name %>
                  <% } else { %>
                    <%= vehicle.brand %> <%= vehicle.model %>
                  <% } %>
                  <% if (vehicle.status === 'active') { %>
                    <span class="vehicle-status-badge status-active">Active</span>
                  <% } else if (vehicle.status === 'maintenance') { %>
                    <span class="vehicle-status-badge status-maintenance">Maintenance</span>
                  <% } else { %>
                    <span class="vehicle-status-badge status-retired">Retired</span>
                  <% } %>
                </h4>
                <div class="vehicle-name-display"><%= vehicle.brand %> <%= vehicle.model %></div>
                <div class="vehicle-info">
                  <span><i class="fas fa-calendar-alt"></i> <%= vehicle.year %></span>
                  <span><i class="fas fa-road"></i> <%= vehicle.mileage.toLocaleString() %> km</span>
                </div>
                <div class="vehicle-plate"><%= vehicle.plate %></div>
                <a href="/vehicles/<%= vehicle.id %>" class="btn btn-sm btn-primary">View details</a>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <div class="vehicle-card empty-card">
            <div class="vehicle-card-content text-center">
              <i class="fas fa-car fa-3x mb-2"></i>
              <h4>No vehicles</h4>
              <p>There are no vehicles registered in the system yet.</p>
              <a href="/vehicles/create" class="btn btn-sm btn-primary">Add vehicle</a>
            </div>
          </div>
        <% } %>
      </div>
    </div>
    <button class="carousel-btn next-btn" aria-label="Next">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
  
  <div class="carousel-indicators" id="carousel-indicators">
    <!-- Dynamically generated indicators -->
  </div>
</div>

<div class="dashboard">
  <div class="row">
    <!-- Vehicles card -->
    <div class="dashboard-card">
      <div class="dashboard-card-icon">
        <i class="fas fa-car"></i>
      </div>
      <div class="dashboard-card-content">
        <h3>Vehicles</h3>
        <p class="dashboard-card-number"><%= vehicles ? vehicles.length : 0 %></p>
        <a href="/vehicles" class="dashboard-card-link">View all <i class="fas fa-arrow-right"></i></a>
      </div>
    </div>
    
    <!-- Maintenance card -->
    <div class="dashboard-card">
      <div class="dashboard-card-icon warning">
        <i class="fas fa-tools"></i>
      </div>
      <div class="dashboard-card-content">
        <h3>Maintenance</h3>
        <p class="dashboard-card-number">
          <%= maintenanceRecords ? maintenanceRecords.length : 0 %>
        </p>
        <a href="/maintenance" class="dashboard-card-link">View details <i class="fas fa-arrow-right"></i></a>
      </div>
    </div>
    
    <!-- Drivers card -->
    <div class="dashboard-card">
      <div class="dashboard-card-icon success">
        <i class="fas fa-user"></i>
      </div>
      <div class="dashboard-card-content">
        <h3>Drivers</h3>
        <p class="dashboard-card-number">
          <% 
            let driversCount = 0;
            if (vehicles) {
              vehicles.forEach(v => {
                if (v.driver) driversCount++;
              });
            }
          %>
          <%= driversCount %>
        </p>
        <a href="#" class="dashboard-card-link">View all <i class="fas fa-arrow-right"></i></a>
      </div>
    </div>
  </div>
  
  <!-- Upcoming Maintenance Section -->
  <div class="card mt-4 mb-4">
    <div class="card-header">
      <div class="d-flex justify-content-between align-items-center">
        <h3>Upcoming Maintenance</h3>
        <a href="/maintenance/create" class="btn btn-success btn-sm">
          <i class="fas fa-plus"></i> Schedule Maintenance
        </a>
      </div>
    </div>
    <div class="card-body">
      <% if (maintenanceRecords && maintenanceRecords.length > 0) { %>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Vehicle</th>
                <th>Type</th>
                <th>Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% maintenanceRecords.forEach(record => { %>
                <tr>
                  <td>
                    <% if (record.vehicle) { %>
                      <a href="/vehicles/<%= record.vehicle.id %>" class="vehicle-link">
                        <%= record.vehicle.brand %> <%= record.vehicle.model %>
                        <% if (record.vehicle.name) { %>
                          <div class="vehicle-name-small"><%= record.vehicle.name %></div>
                        <% } %>
                        <div class="vehicle-plate"><%= record.vehicle.plate %></div>
                      </a>
                    <% } else { %>
                      <span class="text-muted">Vehicle not found</span>
                    <% } %>
                  </td>
                  <td>
                    <% 
                    let serviceName = 'Other';
                    if (serviceTypes && serviceTypes.length > 0) {
                      const serviceType = serviceTypes.find(s => s.id === record.maintenanceType);
                      if (serviceType) {
                        serviceName = serviceType.name;
                      }
                    }
                    %>
                    <%= serviceName %>
                  </td>
                  <td><%= new Date(record.scheduleDate).toLocaleDateString() %></td>
                  <td>
                    <span class="status-badge 
                      <%= record.status === 'scheduled' ? 'status-warning' : 
                         record.status === 'in_progress' ? 'status-primary' : 
                         record.status === 'completed' ? 'status-active' : 
                         'status-retired' %>">
                      <%= record.status === 'scheduled' ? 'Scheduled' : 
                         record.status === 'in_progress' ? 'In Progress' : 
                         record.status === 'completed' ? 'Completed' : 
                         'Cancelled' %>
                    </span>
                  </td>
                  <td class="action-cell">
                    <a href="/maintenance/<%= record.id %>" class="btn-icon text-primary" title="View details">
                      <i class="fas fa-eye"></i>
                    </a>
                    <a href="/maintenance/<%= record.id %>/edit" class="btn-icon text-warning" title="Edit">
                      <i class="fas fa-edit"></i>
                    </a>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <div class="text-center p-4">
          <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
          <h4>No Pending Maintenance</h4>
          <p>There are no maintenance tasks scheduled at the moment.</p>
          <a href="/maintenance/create" class="btn btn-primary mt-2">
            <i class="fas fa-plus-circle"></i> Schedule Maintenance
          </a>
        </div>
      <% } %>
    </div>
  </div>
</div>

<%- include('partials/footer') %> 